{{/*
  Партиал: product-detail-block.html
  Назначение: Полный блок отображения товара с изображениями и информацией
  
  Использование:
    {{ partial "product-detail-block.html" . }}
  
  Контекст:
    - Принимает стандартный контекст страницы (.)
    - Автоматически получает данные товара через get-product-data.html
  
  Регионы:
    - Левая колонка: основное изображение и галерея миниатюр
    - Правая колонка: информация о товаре, цена, кнопки покупки
*/}}

{{ $productData := partial "get-product-data.html" . }}
{{ $product := $productData.product }}
{{ $productID := $productData.productID }}
{{ $pageParams := $productData.pageParams }}

<div id="container12" class="container-component instance-12 style-3 columns">
  <div class="wrapper">
    <div class="inner">
      <div>
        <div id="image11" class="image-component instance-11 style-5">
          <a href="{{ with index $product.purchase_links 0 }}{{ .url }}{{ end }}" class="frame">
            {{ if and $product.images (index $product.images 0) (index $product.images 0).src }}
              {{ $mainImage := resources.Get (index $product.images 0).src }}
              {{ if $mainImage }}
                {{ $filter := images.UnsharpMask 0.5 0.5 0 }}
                {{ $processed := $mainImage.Filter $filter }}
                {{/* Responsive sizes for product main image */}}
                {{ $small := $processed.Fill "500x375 webp picture Center q90" }}
                {{ $large := $processed.Fill "800x600 webp picture Center q90" }}
                <img 
                  src="{{ $large.RelPermalink }}"
                  srcset="{{ $small.RelPermalink }} 500w,
                          {{ $large.RelPermalink }} 800w"
                  sizes="(max-width: 736px) 100vw, 50vw"
                  alt="{{ or (index $product.images 0).alt $product.title | markdownify | plainify }}"
                  title="Buy {{ $product.title | markdownify | plainify }}"
                  width="{{ $large.Width }}"
                  height="{{ $large.Height }}"
                  fetchpriority="high"
                  loading="eager" />
              {{ else }}
                <img src="/images/placeholder.jpg" 
                  alt="{{ $product.title | markdownify | plainify }}" 
                  title="Buy {{ $product.title | markdownify | plainify }}"
                  width="800"
                  height="600"
                  loading="eager" />
              {{ end }}
            {{ else }}
              <img src="/images/placeholder.jpg" 
                alt="{{ $product.title | markdownify | plainify }}" 
                title="Buy {{ $product.title | markdownify | plainify }}"
                width="800"
                height="600"
                loading="eager" />
            {{ end }}
          </a>
        </div>
        <div id="gallery05" class="gallery-component instance-5 style-5 productGallery">
          <div class="inner">
            <ul>
              {{ range $index, $image := $product.images }}
              {{ if and (gt $index 0) (lt $index 3) }}
              <li>
                {{ if eq $index 1 }}
                <span class="thumbnail n0{{ $index }}">
                {{ else }}
                <a href="#exterior" class="thumbnail n0{{ $index }}">
                {{ end }}
                  <span class="frame">
                    {{ if $image.src }}
                      {{ $thumbImage := resources.Get $image.src }}
                      {{ if $thumbImage }}
                        {{ $filter := images.UnsharpMask 0.5 0.5 0 }}
                        {{ $processed := $thumbImage.Filter $filter }}
                        {{/* Responsive sizes for gallery thumbnails */}}
                        {{ $thumbSmall := $processed.Fill "300x225 webp picture Center q90" }}
                        {{ $thumbLarge := $processed.Fill "500x375 webp picture Center q90" }}
                        <img 
                          src="{{ $thumbLarge.RelPermalink }}"
                          srcset="{{ $thumbSmall.RelPermalink }} 300w,
                                  {{ $thumbLarge.RelPermalink }} 500w"
                          sizes="(max-width: 736px) 50vw, 25vw"
                          alt="{{ or $image.alt $product.title | markdownify | plainify }}"
                          title="{{ or $image.alt $product.title | markdownify | plainify }}"
                          width="{{ $thumbLarge.Width }}"
                          height="{{ $thumbLarge.Height }}"
                          loading="lazy" />
                      {{ else }}
                        <img src="/images/placeholder-thumb.jpg" 
                          alt="{{ or $image.alt $product.title | markdownify | plainify }}"
                          title="{{ or $image.alt $product.title | markdownify | plainify }}"
                          width="500"
                          height="375"
                          loading="lazy" />
                      {{ end }}
                    {{ else }}
                      <img src="/images/placeholder-thumb.jpg" 
                        alt="{{ or $image.alt $product.title | markdownify | plainify }}"
                        title="{{ or $image.alt $product.title | markdownify | plainify }}"
                        width="500"
                        height="375"
                        loading="lazy" />
                    {{ end }}
                  </span>
                {{ if eq $index 1 }}
                </span>
                {{ else }}
                </a>
                {{ end }}
              </li>
              {{ end }}
              {{ end }}
            </ul>
          </div>
        </div>
        <hr id="divider20" class="divider-component instance-20 style-3">
      </div>
      <div>
        <p id="text61" class="text-component instance-61 style-3">
          <a href="{{ if hasPrefix $productID "exterior" }}{{ "/exterior" | relURL }}{{ else }}{{ "/interior" | relURL }}{{ end }}">{{ if hasPrefix $productID "exterior" }}Exterior{{ else }}Interior{{ end }} products</a>
        </p>
        <p id="text27" class="text-component instance-27 style-12">{{ or $pageParams.size $product.size }}</p>
        <h2 id="text52" class="text-component instance-52 style-5">{{ or $pageParams.title $product.title | markdownify }}</h2>
        <p id="text53" class="text-component instance-53 style-3">{{ or $pageParams.description $product.description | markdownify }}</p>
        <div id="list03" class="list-component instance-3 style-2">
          <ul>
            {{ range or $pageParams.features $product.features }}
            <li>
              <p>{{ . }}</p>
            </li>
            {{ end }}
          </ul>
        </div>
        <h1 id="text54" class="text-component instance-54 style-11">${{ $product.price }}</h1>
        <p id="text58" class="text-component instance-58 style-3"><strong>{{ $product.price_note }}</strong></p>
        <ul id="buttons16" class="buttons-component instance-16 style-5">
          {{ $defaultButtons := slice "Buy on AK Dealer Services" "Buy on Amazon" }}
          {{ range $index, $link := $product.purchase_links }}
          {{ if $link.url }}
          <li>
            <a href="{{ $link.url }}" class="n0{{ add $index 1 }}" role="button">
              <svg aria-labelledby="buttons16-icon-{{ add $index 1 }}-title">
                <title id="buttons16-icon-{{ add $index 1 }}-title">Cart</title>
                <use xlink:href="{{ "/icons.svg#cart" | relURL }}"></use>
              </svg>
              <span class="label">{{ if $link.name }}{{ $link.name }}{{ else }}{{ index $defaultButtons $index }}{{ end }}</span>
            </a>
          </li>
          {{ end }}
          {{ end }}
          <li>
            <a href="{{ $.Site.Params.wholesaleFormUrl }}" class="n03" role="button">
              <svg aria-labelledby="buttons16-icon-3-title">
                <title id="buttons16-icon-3-title">Cart</title>
                <use xlink:href="{{ "/icons.svg#cart" | relURL }}"></use>
              </svg>
              <span class="label">Wholesale Inquiry</span>
            </a>
          </li>
        </ul>
        <p id="text02" class="text-component instance-2 style-3">
          <a href="{{ with $product.purchase_links }}{{ with index . 0 }}{{ .url }}{{ end }}{{ end }}">{{ $product.best_price_note | default "Best Price for AK Dealer Services" }}</a>
        </p>
        <hr id="divider28" class="divider-component instance-28 style-3">
      </div>
    </div>
  </div>
</div>
