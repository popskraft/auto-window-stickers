{{ define "main" }}

{{ $section := .Section }}
{{ $products := slice }}

{{/* Special handling: the Articles section lists articles, not products */}}
{{ if eq $section "articles" }}
  <div class="container">
    <div class="wrapper">
      <div class="inner">
        {{ range .Pages }}
          <article class="mb-8">
            <h2 class="text-2xl font-semibold"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
            {{ with .Params.description }}<p class="opacity-80">{{ . }}</p>{{ end }}
          </article>
        {{ end }}
      </div>
    </div>
  </div>
  {{- /* Do not attempt product card rendering for articles */ -}}
  {{- return -}}
{{ end }}

{{ range $page := where .Site.RegularPages "Section" $section }}
  {{ $productID := $page.File.ContentBaseName }}
  {{ if isset site.Data.products $productID }}
    {{ $products = $products | append $productID }}
  {{ end }}
{{ end }}

{{ $sortedProducts := slice }}
{{ range $productID := $products }}
  {{ $product := index site.Data.products $productID }}
  {{ $sortedProducts = $sortedProducts | append (dict "id" $productID "weight" (default 999 $product.weight)) }}
{{ end }}
{{ $sortedProducts = sort $sortedProducts "weight" }}
{{ $products = slice }}
{{ range $item := $sortedProducts }}
  {{ $products = $products | append $item.id }}
{{ end }}

	{{ $totalProducts := len $products }}
{{ $rowCount := div (add $totalProducts 1) 2 }}

{{ range $rowIndex := seq 1 $rowCount }}
<div id="product-row-{{ $rowIndex }}" class="style5 product-row container columns">
	<div class="wrapper">
		<div class="inner justify-left">
			{{ $product1Index := sub (mul $rowIndex 2) 2 }}
			{{ $product2Index := sub (mul $rowIndex 2) 1 }}
			
			{{ if lt $product1Index $totalProducts }}
			{{ $product1ID := index $products $product1Index }}
{{ if and $product1ID (index site.Data.products $product1ID) }}
{{ $product1 := index site.Data.products $product1ID }}
{{ partial "product-card.html" (dict "product" $product1 "id" $product1ID "wholesaleUrl" site.Params.wholesaleFormUrl) }}
{{ end }}
			{{ end }}
			
			{{ if lt $product2Index $totalProducts }}
			{{ $product2ID := index $products $product2Index }}
{{ if and $product2ID (index site.Data.products $product2ID) }}
{{ $product2 := index site.Data.products $product2ID }}
{{ partial "product-card.html" (dict "product" $product2 "id" $product2ID "wholesaleUrl" site.Params.wholesaleFormUrl) }}
{{ end }}
			{{ end }}
		</div>
	</div>
</div>
{{ end }}

{{ end }}
