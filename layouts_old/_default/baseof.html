{{- $seoTitle := .Params.seoTitle -}}
{{ $filename := "" }}
{{ with .File }}
  {{ $filename = .BaseFileName | replaceRE "^[^/]+/" "" }}
{{ end }}

{{- if not $seoTitle -}}
  {{- if .File -}}
    {{/* For product pages, include product name if available */}}
    {{- $productName := index .Site.Data.products $filename "productName" -}}
    {{- $titleSuffix := or .Params.seoTitleSuffix .Title -}}
    {{- $seoTitle = cond $productName 
        (printf "%s - %s" $productName $titleSuffix)
        (printf "%s" $titleSuffix) -}}
  {{- else -}}
    {{- $seoTitle = printf "%s" (or .Params.seoTitleSuffix .Title) -}}
  {{- end -}}
{{- end -}}

{{- $seoTitle = printf "%s %s" $seoTitle .Site.Params.seoTitleAfter | markdownify | plainify -}}

{{- $description := or (.Params.seoDescription) (.Params.description) (.Content) (.Description) (.Site.Params.description) -}}
{{- $description = $description | markdownify | plainify | truncate 164 -}}
{{- $siteName := .Site.Title -}}
<!DOCTYPE HTML>
<html lang="{{ .Site.LanguageCode }}">

<head>
  <title>{{ $seoTitle }}</title>
  <meta charset="utf-8">
  {{- $canonical := or (.Params.canonical) (.Permalink) -}}
  <link rel="canonical" href="{{ $canonical }}">
  {{- if .Params.noindex }}
  <meta name="robots" content="noindex">
  {{- end }}
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="{{ $description }}">
  <meta property="og:site_name" content="{{ $siteName }}">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:title" content="{{ $seoTitle }}">
  <meta property="og:type" content="{{ .Site.Params.openGrapeType }}">
  <meta property="og:description" content="{{ $description }}">

  {{- $baseURL := .Site.BaseURL }}
  {{- $ogImagePath := or (index .Site.Data.products $filename "ogImage") .Params.ogImage .Site.Params.ogImage }}
  {{- with or (index (.Resources.ByType "image") 0) (resources.Get $ogImagePath) }}
  {{- $OGcover := .Fill "1280x800 webp picture Center" }}
  <meta property="og:image" content="{{ $baseURL }}{{ $OGcover.RelPermalink }}">
  {{- end }}

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100..900&family=Wix+Madefor+Display:wght@400..800&display=swap"
    rel="stylesheet">
    
  {{- if .Site.Params.prefetch.enabled -}}
  <!-- Prefetch important pages for faster navigation -->
  {{- range .Site.Params.prefetch.pages -}}
  <link rel="prefetch" href="{{ . }}">
  <link rel="prerender" href="{{ . }}">
  {{- end -}}
  
  <!-- Prefetch external URLs -->
  {{- if .Site.Params.prefetch.externalUrls -}}
  {{- range .Site.Params.prefetch.externalUrls -}}
  <link rel="dns-prefetch" href="{{ . }}">
  <link rel="preconnect" href="{{ . }}">
  {{- end -}}
  {{- end -}}
  {{- end -}}
  
  <link rel="icon" type="image/png" href="{{ "favicon.png" | relURL }}">
  <link rel="apple-touch-icon" href="{{ "apple-touch-icon.png" | relURL }}">

  {{ with resources.Get "main.css" }}
  {{ $styles := . | minify }}
  {{ $styles := $styles | fingerprint }}
  <link rel="stylesheet" href="{{ $styles.RelPermalink }}" integrity="{{ $styles.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}

  {{ with resources.Get "tailwindstyle.css" }}
  {{ $tailwind := . | minify }}
  {{ $tailwind := $tailwind | fingerprint }}
  <link rel="stylesheet" href="{{ $tailwind.RelPermalink }}" integrity="{{ $tailwind.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}

  <noscript>
    {{ with resources.Get "noscript.css" }}
    {{ $noscript := . | minify }}
    {{ $noscript := $noscript | fingerprint }}
    <link rel="stylesheet" href="{{ $noscript.RelPermalink }}" integrity="{{ $noscript.Data.Integrity }}">
    {{ end }}
  </noscript>

  {{ partial "schema-org" . }}

</head>

<body class="is-loadin type-{{ .Type }} {{ with .Layout }}layout-{{.}}{{end}} {{ with .Section }}section-{{.}}{{end}}">
  <div id="wrapper">
    <div id="main">
      <div class="inner">
        {{ partial "header" . }}
        <section id="home-section">
          {{ block "main" . }}{{ end }}
        </section>
        {{/*  {{ partial "wholesale-section" . }}  */}}
        {{/*  {{ partial "contact-section" . }}  */}}
        {{ partial "footer" . }}
      </div>
    </div>
  </div>
  
  {{ with resources.Get "main.js" }}
    {{ $script := .  | minify  }}
    <script src="{{ $script.RelPermalink }}"></script>
  {{ end }}

  {{/*  SLIDER SCRIPT  */}}
  {{ $sliderImages := or (index $.Site.Data.products $filename "slider") .Page.Params.slider }}
  {{ if eq .Type "product" }}
    {{ if $sliderImages }}
      <script>
        window.sliderConfig = {
          images: [
            {{ range $sliderImages }}
            {
              src: '{{ .image }}',
              position: 'center',
              caption: '{{ .caption }}'
            },
            {{ end }}
          ]
        };
      </script>
    {{ end }}
    {{ with resources.Get "js/coverSlider.js" }}
      {{ $script := .  | minify  }}
      <script src="{{ $script.RelPermalink }}"></script>
    {{ end }}
  {{ end }}
  
  {{ with resources.Get "js/theme.js" }}
  {{ $themeScript := . | minify }}
  <script defer src="{{ $themeScript.RelPermalink }}" integrity="{{ $themeScript.Data.Integrity }}" crossorigin="anonymous"></script>
  {{ end }}

  {{ template "_internal/google_analytics.html" . }}
  
</body>
</html>